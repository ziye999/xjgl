Ext.ns("Ext.ux");Ext.ns("Ext.ux.menu");Ext.ux.Button=Ext.extend(Ext.Button,{constructor:function(cfg){Ext.ux.Button.superclass.constructor.call(this,cfg);},onRender:function(ct,position){Ext.ux.Button.superclass.onRender.call(this,ct,position);},onClick:function(e){if(!this.PermissionsPointControl()){Ext.MessageBox.show({title:"友情提示",msg:"您没有该操作权限,请与管理员联�?!",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK});return;}Ext.ux.Button.superclass.onClick.call(this,e);},PermissionsPointControl:function(){if(!Ext.isDefined(this.PermissionCode)){return true;}var getCurrentMoudle=JH.getCurrentMoudle();var PermissionCode=this.PermissionCode;var userid=JH.USER.userid;var returnValue=false;if(!Ext.isEmpty(getCurrentMoudle)&&!Ext.isEmpty(PermissionCode)){SAC.hasPermission(userid,getCurrentMoudle.id,PermissionCode,function(r){returnValue=r;});}return returnValue;}});Ext.reg("uxbutton",Ext.ux.Button);Ext.ux.menu.Item=Ext.extend(Ext.menu.Item,{constructor:function(cfg){Ext.ux.menu.Item.superclass.constructor.call(this,cfg);},onRender:function(ct,position){Ext.ux.menu.Item.superclass.onRender.call(this,ct,position);},onClick:function(e){Ext.ux.menu.Item.superclass.onClick.call(this,e);},PermissionsPointControl:function(){var getCurrentMoudle=JH.getCurrentMoudle();var PermissionCode=this.PermissionCode;var userid=JH.USER.userid;var returnValue=false;if(!Ext.isEmpty(getCurrentMoudle)&&!Ext.isEmpty(PermissionCode)){SAC.hasPermission(userid,getCurrentMoudle.id,PermissionCode,function(r){returnValue=r;});}return returnValue;}});Ext.reg("uxmenuitem",Ext.ux.menu.Item);Ext.ns("Ext.ux");(function(){Ext.ux.ChartPanel=Ext.extend(Ext.Panel,{url:"",iframeId:"",width:null,baseParams:{},height:null,constructor:function(config){this.iframeId=Ext.id();var service=Ext.isDefined(config.service)?config.service:JH.getCurrentService();var method=config.method;Ext.applyIf(config,{width:"100%",height:"100%",anchor:"100% 100%"});this.url=JH.getAjaxURL()+"?service="+service+"&method="+method+"&temp="+new Date().getTime();Ext.ux.ChartPanel.superclass.constructor.call(this,config);},show:function(ct,position){Ext.ux.ChartPanel.superclass.show.call(this,ct,position);this.width=this.getInnerWidth();this.height=this.ownerCt.getInnerHeight();},repaint:function(params){Ext.apply(this.baseParams,params);JH.$request({method:"POST",msgTitle:"正在生产图形.......",params:Ext.apply({width:this.width,height:this.height,ajax_request:"1"},this.baseParams),url:this.url,scope:this,loader:false,handler:function(MsgBean,scope){scope.insert(0,{width:scope.width,heigth:scope.height,html:MsgBean.data});scope.doLayout();}});}});})();Ext.reg("uxform",Ext.ux.FormPanel);Ext.ns("Ext.ux");(function(){Ext.ux.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(config){Ext.applyIf(config,{rowNumber:true,page:true,grouping:false,pagecombox:true,excelTitle:"",sm:new Ext.grid.CheckboxSelectionModel({singleSelect:true}),rowSelect:false,rowSingleSelect:false,displayInfo:true,excel:false,viewConfig:{autoFill:true}});if(config.rowNumber){config.cm.splice(0,0,new Ext.grid.RowNumberer({header:"序号",width:40}));}if(config.rowSelect){var sm=new Ext.grid.CheckboxSelectionModel({singleSelect:config.rowSingleSelect});config.cm.splice(1,0,sm);config.sm=sm;}config.cm=new Ext.grid.ColumnModel(config.cm);if(config.grouping){config.store=new Ext.data.GroupingStore({baseParams:{method:config.method,service:Ext.isDefined(config.service)?config.service:JH.getCurrentService()},url:JH.getAjaxURL(),reader:new Ext.data.JsonReader({remoteSort:true,autoLoad:false,root:"resultList",totalProperty:"totalPages",fields:config.fields}),groupField:Ext.isDefined(config.groupField)?config.groupField:config.fileds[0]});}else{config.store=new Ext.data.JsonStore({root:"resultList",totalProperty:"totalPages",baseParams:{method:config.method,service:Ext.isDefined(config.service)?config.service:JH.getCurrentService()},url:JH.getAjaxURL(),fields:config.fields});}if(config.page){var combox=this.getCombox();config.bbar=new Ext.PagingToolbar({displayInfo:true,pageSize:20,store:config.store,displayMsg:"显示第{0}到{1}数据,共{2}�?",emptyMsg:"无数�?",displayInfo:config.displayInfo});if(config.excel){config.bbar.add("-");config.bbar.add({tooltip:"导出EXCEL",xtype:"button",iconCls:"p-icons-excel",handler:this.exportExcel,scope:this});}if(config.pagecombox){var combox=this.getCombox();config.bbar.add("-");config.bbar.add("每页数显�?:");config.bbar.add(combox);config.bbar.add("�?");combox.on("select",this.doPageSizeSelect,config.bbar);}}Ext.applyIf(config,{loadMask:{msg:"数据读取�?,请稍�?......"}});Ext.ux.GridPanel.superclass.constructor.call(this,config);},getCombox:function(items){return new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",name:"limit",value:20,width:40,store:new Ext.data.ArrayStore({fields:["limit","displayText"],data:[[20,"20"],[50,"50"],[100,"100"],[150,"150"],[200,"200"]]}),valueField:"limit",displayField:"displayText"});},doPageSizeSelect:function(combo,record,index){this.pageSize=record.get("limit");this.doLoad(this.cursor);},$load:function(params,callback,scope,add){if(Ext.isObject(params)&&this.page){Ext.apply(this.store.baseParams,{start:this.cursor,limit:this.bbar.pageSize});Ext.apply(this.store.baseParams,params);this.store.load({params:params,callback:callback,scope:scope,add:add});}else{Ext.apply(this.store.baseParams,params);this.store.load({params:{},callback:callback,scope:scope,add:add});}},exportExcel:function(){var columns=[];var data=[];var cm=this.getColumnModel();var count=cm.getColumnCount();Ext.each(cm.config,function(column){if(!Ext.isEmpty(column.dataIndex)){this.push({header:column.header,width:column.width,dataIndex:column.dataIndex,aligns:column.align});}},columns);this.store.each(function(record){data.push(record.data);},this);JH.$request({msgTitle:"正在导出EXCEL,请稍�?......",service:"ExcelService",method:"exportExcel",scope:this,handler:function(MsgBean,scope){if(!Ext.isEmpty(MsgBean.data)){var url=JH.getAjaxURL();var u=Ext.urlEncode({service:"ExcelService",method:"downLoadExcelByTag",tag:MsgBean.data});url+="?"+u;url+="&title="+scope.excelTitle;window.location.href=url;}},params:{headers:Ext.util.JSON.encode(columns),dataset:Ext.util.JSON.encode(data),excelTitle:this.excelTitle}});}});})();Ext.reg("uxgrid",Ext.ux.GridPanel);Ext.ux.ComboxGrid=Ext.extend(Ext.form.ComboBox,{gridid:null,constructor:function(config){this.gridid=Ext.id()+"_comboxgrid";Ext.applyIf(config,{store:new Ext.data.SimpleStore({fields:["codeid","codename"],data:[[]]}),editable:false,mode:"local",triggerAction:"all",tpl:"<div id="+this.gridid+"></div>",selectCfg:{codeid:"",codename:""},cm:[],fields:[],height:200,rowNumber:false,selectedClass:"",method:"",service:Ext.isDefined(config.service)?config.service:JH.getCurrentService(),onSelect:Ext.emptyFn,valueField:"codeid",displayField:"codename"});config.grid=new Ext.ux.GridPanel({rowNumber:config.rowNumber,height:config.height,pagecombox:false,displayInfo:false,method:config.method,service:config.service,cm:config.cm,fields:config.fields});Ext.ux.ComboxGrid.superclass.constructor.call(this,config);this.on("expand",this.doExpand,this);this.grid.on("rowclick",this.rowclick,this);},onViewClick:function(){},doExpand:function(){this.grid.render(this.gridid);this.grid.$load();},rowclick:function(grid,rowindex,e){var codeid=grid.store.getAt(rowindex).data[this.selectCfg.codeid];var codename=grid.store.getAt(rowindex).data[this.selectCfg.codename];var rt=this.store.recordType;var r=new rt();r.data["codeid"]=codeid;r.data["codename"]=codename;if(this.fireEvent("beforeselect",this,r,rowindex)!==false){this.setRawValue(r.data["codename"]);this.hiddenValue=r.data["codeid"];this.collapse();this.fireEvent("select",this,r,rowindex);}}});Ext.reg("uxcomboxgrid",Ext.ux.ComboxGrid);Ext.ux.Combox=Ext.extend(Ext.form.ComboBox,{disabled:false,constructor:function(cfg){Ext.applyIf(cfg,{params:{},valueNotFoundText:"",forceSelection:true,lazyInit:false,Dynic:false,addEmpty:true});Ext.applyIf(cfg,{store:new Ext.data.JsonStore({autoLoad:true,baseParams:Ext.apply({method:Ext.isDefined(cfg.method)?cfg.method:"geiDropListByClassCode",service:Ext.isDefined(cfg.service)?cfg.service:"DropListService"},cfg.params),url:JH.getAjaxURL(),fields:Ext.isDefined(cfg.fields)?cfg.fields:["codeid","codename"]}),typeAhead:true,triggerAction:"all",lazyRender:true,mode:"remote",valueField:"codeid",displayField:"codename"});Ext.applyIf(this,cfg);if(cfg.Dynic){this.on("expand",function(com){com.store.removeAll(true);});}Ext.ux.Combox.superclass.constructor.call(this,cfg);},onRender:function(ct,position){var disabled=this.disabled;this.disabled=false;Ext.ux.Combox.superclass.onRender.call(this,ct,position);if(disabled===true){this.setDisabled(disabled);}}});Ext.reg("uxcombox",Ext.ux.Combox);Ext.ux.ComboxTree=Ext.extend(Ext.form.ComboBox,{treeId:null,tree:null,constructor:function(cfg){this.tree=cfg.tree,this.treeId=Ext.id();Ext.applyIf(cfg,{typeAhead:true,triggerAction:"all",mode:"local",store:new Ext.data.Store({proxy:new Ext.data.MemoryProxy([[]]),reader:new Ext.data.ArrayReader({},[[],[]])})});Ext.ux.ComboxTree.superclass.constructor.call(this,{store:new Ext.data.SimpleStore({fields:[],data:[[]]}),editable:false,mode:"local",triggerAction:"all",tpl:'<div  style="height:'+this.height+'px"><div id='+this.treeId+"></div></div>",selectedClass:"",onSelect:Ext.emptyFn});},onTriggerClick:function(){var a=[this.el].concat(this.listAlign);this.tpl="<div id='"+this.treeId+"'></div>";alert(this.id);this.tree.render(this.treeId);box.tpl="<div id='"+config.divid+"'></div>";Ext.ux.ComboxTree.superclass.onTriggerClick.call(this);}});Ext.reg("uxcomboxtree",Ext.ux.ComboxTree);Ext.ns("Ext.ux");(function(){Ext.ux.FormPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(config){Ext.applyIf(config,{labelWidth:65,bodyStyle:"padding:5px",url:JH.getAjaxURL(),frame:true,border:true,labelAlign:"right"});Ext.ux.FormPanel.superclass.constructor.call(this,config);},$submit:function(config){if(!this.getForm().isValid()){return;}Ext.applyIf(config,{handler:function(){}});Ext.applyIf(config,{showMask:true,clientValidation:true,params:{},success:function(form,action){if(Ext.isDefined(action.result.show)&&action.result.show){Ext.Msg.show({title:"消息!",msg:action.result.msg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO,scope:config.scope,fn:function(){config.handler(form,action.result,config.scope);}});}else{config.handler(form,action.result,config.scope);}},failure:function(form,action){switch(action.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.Msg.show({title:"错误",msg:"提交的表单可能含有错误的数�??!",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.CONNECT_FAILURE:Ext.Msg.show({title:"错误信息",msg:"访问后台失败,出现未处理异常信�?,请检验后台信�?!",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.LOAD_FAILURE:Ext.Msg.show({title:"错误信息",msg:action.result.msg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.SERVER_INVALID:Ext.Msg.show({title:"错误信息",msg:action.result.msg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;default:Ext.Msg.show({title:"错误信息",msg:"未知错误!",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});}}});Ext.applyIf(config.params,{ajax_request:"1",service:Ext.isDefined(config.service)?config.service:JH.getCurrentService(),method:config.method});Ext.each(this.items.items,function(f){if(Ext.isDefined(Ext.ux.ComboxGrid)&&f instanceof Ext.ux.ComboxGrid){delete this[f.name];this[f.name]=f.hiddenValue;}},config.params);config.method="POST";if(config.showMask){Ext.applyIf(config,{waitTitle:"请稍�?",waitMsg:"正在提交... ..."});}this.getForm().submit(config);},$load:function(config){Ext.applyIf(config,{handler:function(){}});Ext.applyIf(config,{params:{},waitTitle:"请稍�?",url:JH.getAjaxURL(),waitMsg:"正在加载数据... ...",success:function(form,action){var MsgBean=JH.$parseJSON(action.response.responseText);config.handler(form,MsgBean,config.scope);},failure:function(form,action){switch(action.failureType){case Ext.form.Action.CONNECT_FAILURE:Ext.Msg.show({title:"错误信息",msg:"访问后台失败,出现未处理异常信�?,请检验后台信�?!",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.LOAD_FAILURE:Ext.Msg.show({title:"错误信息",msg:action.result.msg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.SERVER_INVALID:Ext.Msg.show({title:"错误信息",msg:action.result.msg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});break;default:Ext.Msg.show({title:"错误信息",msg:"未知错误!",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});}}});Ext.applyIf(config.params,{ajax_request:"1",service:Ext.isDefined(config.service)?config.service:JH.getCurrentService(),method:config.method});config.method="POST";this.getForm().load(config);},$reset:function(){this.getForm().reset();}});})();Ext.reg("uxform",Ext.ux.FormPanel);Ext.ns("Ext.ux.form");Ext.ux.form.MultiSelect=Ext.extend(Ext.form.Field,{ddReorder:false,appendOnly:false,width:100,height:100,displayField:0,valueField:1,allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) allowed",delimiter:",",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.form.MultiSelect.superclass.initComponent.call(this);if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.ArrayStore({fields:["value","text"],data:this.store});this.valueField="value";}else{this.store=new Ext.data.ArrayStore({fields:["text"],data:this.store,expandData:true});this.valueField="text";}this.displayField="text";}else{var stroe=new Ext.data.JsonStore({baseParams:{method:this.method,service:Ext.isDefined(this.service)?this.service:JH.getCurrentService()},url:JH.getAjaxURL(),fields:["codeid","codename"]});this.valueField="codeid";this.displayField="codename";this.store=Ext.StoreMgr.lookup(stroe);}this.addEvents({"dblclick":true,"click":true,"change":true,"drop":true});},onRender:function(ct,position){Ext.ux.form.MultiSelect.superclass.onRender.call(this,ct,position);var fs=this.fs=new Ext.form.FieldSet({renderTo:this.el,title:this.title,height:this.height,width:this.width,style:"padding:0;",tbar:this.tbar});fs.body.addClass("ux-mselect");this.view=new Ext.ListView({multiSelect:true,store:this.store,columns:[{header:"Value",width:1,dataIndex:this.displayField}],hideHeaders:true});fs.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeclick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.hiddenName=this.name||Ext.id();var hiddenTag={tag:"input",type:"hidden",value:"",name:this.hiddenName};this.hiddenField=this.el.createChild(hiddenTag);this.hiddenField.dom.disabled=this.hiddenName!=this.name;fs.doLayout();},afterRender:function(){Ext.ux.form.MultiSelect.superclass.afterRender.call(this);if(this.ddReorder&&!this.dragGroup&&!this.dropGroup){this.dragGroup=this.dropGroup="MultiselectDD-"+Ext.id();}if(this.draggable||this.dragGroup){this.dragZone=new Ext.ux.form.MultiSelect.DragZone(this,{ddGroup:this.dragGroup});}if(this.droppable||this.dropGroup){this.dropZone=new Ext.ux.form.MultiSelect.DropZone(this,{ddGroup:this.dropGroup});}},onViewClick:function(vw,index,node,e){this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,e);this.validate();},onViewBeforeClick:function(vw,index,node,e){if(this.disabled||this.readOnly){return false;}},onViewDblClick:function(vw,index,node,e){return this.fireEvent("dblclick",vw,index,node,e);},getValue:function(valueField){var returnArray=[];var selectionsArray=this.view.getSelectedIndexes();if(selectionsArray.length==0){return"";}for(var i=0;i<selectionsArray.length;i++){returnArray.push(this.store.getAt(selectionsArray[i]).get((valueField!=null)?valueField:this.valueField));}return returnArray.join(this.delimiter);},setValue:function(values){var index;var selections=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!values||(values=="")){return;}if(!Ext.isArray(values)){values=values.split(this.delimiter);}for(var i=0;i<values.length;i++){index=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+values[i]+"$","i")).itemAt(0));selections.push(index);}this.view.select(selections);this.hiddenField.dom.value=this.getValue();this.validate();},reset:function(){this.setValue("");},getRawValue:function(valueField){var tmp=this.getValue(valueField);if(tmp.length){tmp=tmp.split(this.delimiter);}else{tmp=[];}return tmp;},setRawValue:function(values){setValue(values);},validateValue:function(value){if(value.length<1){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}if(value.length<this.minSelections){this.markInvalid(String.format(this.minSelectionsText,this.minSelections));return false;}if(value.length>this.maxSelections){this.markInvalid(String.format(this.maxSelectionsText,this.maxSelections));return false;}return true;},disable:function(){this.disabled=true;this.hiddenField.dom.disabled=true;this.fs.disable();},enable:function(){this.disabled=false;this.hiddenField.dom.disabled=false;this.fs.enable();},destroy:function(){Ext.destroy(this.fs,this.dragZone,this.dropZone);Ext.ux.form.MultiSelect.superclass.destroy.call(this);}});Ext.reg("multiselect",Ext.ux.form.MultiSelect);Ext.ux.Multiselect=Ext.ux.form.MultiSelect;Ext.ux.form.MultiSelect.DragZone=function(ms,config){this.ms=ms;this.view=ms.view;var ddGroup=config.ddGroup||"MultiselectDD";var dd;if(Ext.isArray(ddGroup)){dd=ddGroup.shift();}else{dd=ddGroup;ddGroup=null;}Ext.ux.form.MultiSelect.DragZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:dd});this.setDraggable(ddGroup);};Ext.extend(Ext.ux.form.MultiSelect.DragZone,Ext.dd.DragZone,{onInitDrag:function(x,y){var el=Ext.get(this.dragData.ddel.cloneNode(true));this.proxy.update(el.dom);el.setWidth(el.child("em").getWidth());this.onStartDrag(x,y);return true;},collectSelection:function(data){data.repairXY=Ext.fly(this.view.getSelectedNodes()[0]).getXY();var i=0;this.view.store.each(function(rec){if(this.view.isSelected(i)){var n=this.view.getNode(i);var dragNode=n.cloneNode(true);dragNode.id=Ext.id();data.ddel.appendChild(dragNode);data.records.push(this.view.store.getAt(i));data.viewNodes.push(n);}i++;},this);},onEndDrag:function(data,e){var d=Ext.get(this.dragData.ddel);if(d&&d.hasClass("multi-proxy")){d.remove();}},getDragData:function(e){var target=this.view.findItemFromChild(e.getTarget());if(target){if(!this.view.isSelected(target)&&!e.ctrlKey&&!e.shiftKey){this.view.select(target);this.ms.setValue(this.ms.getValue());}if(this.view.getSelectionCount()==0||e.ctrlKey||e.shiftKey){return false;}var dragData={sourceView:this.view,viewNodes:[],records:[]};if(this.view.getSelectionCount()==1){var i=this.view.getSelectedIndexes()[0];var n=this.view.getNode(i);dragData.viewNodes.push(dragData.ddel=n);dragData.records.push(this.view.store.getAt(i));dragData.repairXY=Ext.fly(n).getXY();}else{dragData.ddel=document.createElement("div");dragData.ddel.className="multi-proxy";this.collectSelection(dragData);}return dragData;}return false;},getRepairXY:function(e){return this.dragData.repairXY;},setDraggable:function(ddGroup){if(!ddGroup){return;}if(Ext.isArray(ddGroup)){Ext.each(ddGroup,this.setDraggable,this);return;}this.addToGroup(ddGroup);}});Ext.ux.form.MultiSelect.DropZone=function(ms,config){this.ms=ms;this.view=ms.view;var ddGroup=config.ddGroup||"MultiselectDD";var dd;if(Ext.isArray(ddGroup)){dd=ddGroup.shift();}else{dd=ddGroup;ddGroup=null;}Ext.ux.form.MultiSelect.DropZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:dd});this.setDroppable(ddGroup);};Ext.extend(Ext.ux.form.MultiSelect.DropZone,Ext.dd.DropZone,{getTargetFromEvent:function(e){var target=e.getTarget();return target;},getDropPoint:function(e,n,dd){if(n==this.ms.fs.body.dom){return"below";}var t=Ext.lib.Dom.getY(n),b=t+n.offsetHeight;var c=t+(b-t)/2;var y=Ext.lib.Event.getPageY(e);if(y<=c){return"above";}else{return"below";}},isValidDropPoint:function(pt,n,data){if(!data.viewNodes||(data.viewNodes.length!=1)){return true;}var d=data.viewNodes[0];if(d==n){return false;}if((pt=="below")&&(n.nextSibling==d)){return false;}if((pt=="above")&&(n.previousSibling==d)){return false;}return true;},onNodeEnter:function(n,dd,e,data){return false;},onNodeOver:function(n,dd,e,data){var dragElClass=this.dropNotAllowed;var pt=this.getDropPoint(e,n,dd);if(this.isValidDropPoint(pt,n,data)){if(this.ms.appendOnly){return"x-tree-drop-ok-below";}if(pt){var targetElClass;if(pt=="above"){dragElClass=n.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";targetElClass="x-view-drag-insert-above";}else{dragElClass=n.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";targetElClass="x-view-drag-insert-below";}if(this.lastInsertClass!=targetElClass){Ext.fly(n).replaceClass(this.lastInsertClass,targetElClass);this.lastInsertClass=targetElClass;}}}return dragElClass;},onNodeOut:function(n,dd,e,data){this.removeDropIndicators(n);},onNodeDrop:function(n,dd,e,data){if(this.ms.fireEvent("drop",this,n,dd,e,data)===false){return false;}var pt=this.getDropPoint(e,n,dd);if(n!=this.ms.fs.body.dom){n=this.view.findItemFromChild(n);}if(this.ms.appendOnly){insertAt=this.view.store.getCount();}else{insertAt=n==this.ms.fs.body.dom?this.view.store.getCount()-1:this.view.indexOf(n);if(pt=="below"){insertAt++;}}var dir=false;if(data.sourceView==this.view){if(pt=="below"){if(data.viewNodes[0]==n){data.viewNodes.shift();}}else{if(data.viewNodes[data.viewNodes.length-1]==n){data.viewNodes.pop();}}if(!data.viewNodes.length){return false;}if(insertAt>this.view.store.indexOf(data.records[0])){dir="down";insertAt--;}}for(var i=0;i<data.records.length;i++){var r=data.records[i];if(data.sourceView){data.sourceView.store.remove(r);}this.view.store.insert(dir=="down"?insertAt:insertAt++,r);var si=this.view.store.sortInfo;if(si){this.view.store.sort(si.field,si.direction);}}return true;},removeDropIndicators:function(n){if(n){Ext.fly(n).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass";}},setDroppable:function(ddGroup){if(!ddGroup){return;}if(Ext.isArray(ddGroup)){Ext.each(ddGroup,this.setDroppable,this);return;}this.addToGroup(ddGroup);}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.form.ItemSelector=Ext.extend(Ext.form.Field,{hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,imagePath:null,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,delimiter:",",bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},multiselects:null,initComponent:function(){Ext.ux.form.ItemSelector.superclass.initComponent.call(this);this.addEvents({"rowdblclick":true,"change":true});},onRender:function(ct,position){Ext.ux.form.ItemSelector.superclass.onRender.call(this,ct,position);var msConfig=[{title:"未�??",draggable:true,droppable:true,width:100,height:100},{title:"已�??",droppable:true,draggable:true,width:100,height:100}];this.fromMultiselect=new Ext.ux.form.MultiSelect(Ext.applyIf(this.multiselects[0],msConfig[0]));this.fromMultiselect.on("dblclick",this.onRowDblClick,this);this.toMultiselect=new Ext.ux.form.MultiSelect(Ext.applyIf(this.multiselects[1],msConfig[1]));this.toMultiselect.on("dblclick",this.onRowDblClick,this);var p=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});p.add(this.fromMultiselect);var icons=new Ext.Panel({header:false});p.add(icons);p.add(this.toMultiselect);p.render(this.el);icons.el.down("."+icons.bwrapCls).remove();this.imagePath=JH.getRoot()+"/plat/ext-ux/img/";if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/";}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var el=icons.getEl();this.toTopIcon=el.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});el.createChild({tag:"br"});this.upIcon=el.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});el.createChild({tag:"br"});this.addIcon=el.createChild({tag:"img",src:this.iconRight,style:{cursor:"pointer",margin:"2px"}});el.createChild({tag:"br"});this.removeIcon=el.createChild({tag:"img",src:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});el.createChild({tag:"br"});this.downIcon=el.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});el.createChild({tag:"br"});this.toBottomIcon=el.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}});this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this);this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this);if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none";}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none";}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none";}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none";}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none";}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none";}var tb=p.body.first();this.el.setWidth(p.body.first().getWidth());p.body.removeClass();this.hiddenName=this.name;var hiddenTag={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(hiddenTag);},doLayout:function(){if(this.rendered){this.fromMultiselect.fs.doLayout();this.toMultiselect.fs.doLayout();}},afterRender:function(){Ext.ux.form.ItemSelector.superclass.afterRender.call(this);this.toStore=this.toMultiselect.store;this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.valueChanged(this.toStore);},toTop:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();var records=[];if(selectionsArray.length>0){selectionsArray.sort();for(var i=0;i<selectionsArray.length;i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);records.push(record);}selectionsArray=[];for(var i=records.length-1;i>-1;i--){record=records[i];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);selectionsArray.push(((records.length-1)-i));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(selectionsArray);},toBottom:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();var records=[];if(selectionsArray.length>0){selectionsArray.sort();for(var i=0;i<selectionsArray.length;i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);records.push(record);}selectionsArray=[];for(var i=0;i<records.length;i++){record=records[i];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);selectionsArray.push((this.toMultiselect.view.store.getCount())-(records.length-i));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(selectionsArray);},up:function(){var record=null;var selectionsArray=this.toMultiselect.view.getSelectedIndexes();selectionsArray.sort();var newSelectionsArray=[];if(selectionsArray.length>0){for(var i=0;i<selectionsArray.length;i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);if((selectionsArray[i]-1)>=0){this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(selectionsArray[i]-1,record);newSelectionsArray.push(selectionsArray[i]-1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(newSelectionsArray);}},down:function(){var record=null;var selectionsArray=this.toMultiselect.view.getSelectedIndexes();selectionsArray.sort();selectionsArray.reverse();var newSelectionsArray=[];if(selectionsArray.length>0){for(var i=0;i<selectionsArray.length;i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);if((selectionsArray[i]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(selectionsArray[i]+1,record);newSelectionsArray.push(selectionsArray[i]+1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(newSelectionsArray);}},fromTo:function(){var selectionsArray=this.fromMultiselect.view.getSelectedIndexes();var records=[];if(selectionsArray.length>0){for(var i=0;i<selectionsArray.length;i++){record=this.fromMultiselect.view.store.getAt(selectionsArray[i]);records.push(record);}if(!this.allowDup){selectionsArray=[];}for(var i=0;i<records.length;i++){record=records[i];if(this.allowDup){var x=new Ext.data.Record();record.id=x.id;delete x;this.toMultiselect.view.store.add(record);}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);selectionsArray.push((this.toMultiselect.view.store.getCount()-1));}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();var si=this.toMultiselect.store.sortInfo;if(si){this.toMultiselect.store.sort(si.field,si.direction);}this.toMultiselect.view.select(selectionsArray);},toFrom:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();var records=[];if(selectionsArray.length>0){for(var i=0;i<selectionsArray.length;i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);records.push(record);}selectionsArray=[];for(var i=0;i<records.length;i++){record=records[i];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);selectionsArray.push((this.fromMultiselect.view.store.getCount()-1));}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();var si=this.fromMultiselect.store.sortInfo;if(si){this.fromMultiselect.store.sort(si.field,si.direction);}this.fromMultiselect.view.select(selectionsArray);},valueChanged:function(store){var record=null;var values=[];for(var i=0;i<store.getCount();i++){record=store.getAt(i);values.push(record.get(this.toMultiselect.valueField));}this.hiddenField.dom.value=values.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);},getValue:function(){return this.hiddenField.dom.value;},onRowDblClick:function(vw,index,node,e){if(vw==this.toMultiselect.view){this.toFrom();}else{if(vw==this.fromMultiselect.view){this.fromTo();}}return this.fireEvent("rowdblclick",vw,index,node,e);},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();this.fromMultiselect.store.add(range);var si=this.fromMultiselect.store.sortInfo;if(si){this.fromMultiselect.store.sort(si.field,si.direction);}this.valueChanged(this.toMultiselect.store);}});Ext.reg("itemselector",Ext.ux.form.ItemSelector);Ext.ux.ItemSelector=Ext.ux.form.ItemSelector;Ext.ux.TabCloseMenu=Ext.extend(Object,{closeTabText:"关闭当前页签",closeOtherTabsText:"关闭其他页签",closeAllTabsText:"关闭所有页签",iconCls:"p-icons-bullet_blue",showCloseAll:true,constructor:function(config){Ext.apply(this,config||{});},init:function(tabs){this.tabs=tabs;tabs.on({scope:this,contextmenu:this.onContextMenu,destroy:this.destroy});},destroy:function(){Ext.destroy(this.menu);delete this.menu;delete this.tabs;delete this.active;},onContextMenu:function(tabs,item,e){this.active=item;var m=this.createMenu(),disableAll=true,disableOthers=true,closeAll=m.getComponent("closeall");m.getComponent("close").setDisabled(!item.closable);tabs.items.each(function(){if(this.closable){disableAll=false;if(this!=item){disableOthers=false;return false;}}});m.getComponent("closeothers").setDisabled(disableOthers);if(closeAll){closeAll.setDisabled(disableAll);}e.stopEvent();m.showAt(e.getPoint());},createMenu:function(){if(!this.menu){var items=[{itemId:"close",text:this.closeTabText,scope:this,iconCls:this.iconCls,handler:this.onClose}];if(this.showCloseAll){items.push("-");}items.push({itemId:"closeothers",text:this.closeOtherTabsText,scope:this,iconCls:this.iconCls,handler:this.onCloseOthers});if(this.showCloseAll){items.push({itemId:"closeall",text:this.closeAllTabsText,scope:this,iconCls:this.iconCls,handler:this.onCloseAll});}this.menu=new Ext.menu.Menu({items:items});}return this.menu;},onClose:function(){this.tabs.remove(this.active);},onCloseOthers:function(){this.doClose(true);},onCloseAll:function(){this.doClose(false);},doClose:function(excludeActive){var items=[];this.tabs.items.each(function(item){if(item.closable){if(!excludeActive||item!=this.active){items.push(item);}}},this);Ext.each(items,function(item){this.tabs.remove(item);},this);}});Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu);Ext.ns("Ext.ux");Ext.ux.TabScrollerMenu=Ext.extend(Object,{pageSize:5,maxText:15,menuPrefixText:"Items",constructor:function(config){config=config||{};Ext.apply(this,config);},init:function(tabPanel){Ext.apply(tabPanel,this.parentOverrides);tabPanel.tabScrollerMenu=this;var thisRef=this;tabPanel.on({render:{scope:tabPanel,single:true,fn:function(){var newFn=tabPanel.createScrollers.createSequence(thisRef.createPanelsMenu,this);tabPanel.createScrollers=newFn;}}});},createPanelsMenu:function(){var h=this.stripWrap.dom.offsetHeight;var rtScrBtn=this.header.dom.firstChild;Ext.fly(rtScrBtn).applyStyles({right:"18px"});var stripWrap=Ext.get(this.strip.dom.parentNode);stripWrap.applyStyles({"margin-right":"36px"});var scrollMenu=this.header.insertFirst({cls:"x-tab-tabmenu-right"});scrollMenu.setHeight(h);scrollMenu.addClassOnOver("x-tab-tabmenu-over");scrollMenu.on("click",this.showTabsMenu,this);this.scrollLeft.show=this.scrollLeft.show.createSequence(function(){scrollMenu.show();});this.scrollLeft.hide=this.scrollLeft.hide.createSequence(function(){scrollMenu.hide();});},getPageSize:function(){return this.pageSize;},setPageSize:function(pageSize){this.pageSize=pageSize;},getMaxText:function(){return this.maxText;},setMaxText:function(t){this.maxText=t;},getMenuPrefixText:function(){return this.menuPrefixText;},setMenuPrefixText:function(t){this.menuPrefixText=t;},parentOverrides:{showTabsMenu:function(e){if(this.tabsMenu){this.tabsMenu.destroy();this.un("destroy",this.tabsMenu.destroy,this.tabsMenu);this.tabsMenu=null;}this.tabsMenu=new Ext.menu.Menu();this.on("destroy",this.tabsMenu.destroy,this.tabsMenu);this.generateTabMenuItems();var target=Ext.get(e.getTarget());var xy=target.getXY();xy[1]+=24;this.tabsMenu.showAt(xy);},generateTabMenuItems:function(){var curActive=this.getActiveTab();var totalItems=this.items.getCount();var pageSize=this.tabScrollerMenu.getPageSize();if(totalItems>pageSize){var numSubMenus=Math.floor(totalItems/pageSize);var remainder=totalItems%pageSize;for(var i=0;i<numSubMenus;i++){var curPage=(i+1)*pageSize;var menuItems=[];for(var x=0;x<pageSize;x++){index=x+curPage-pageSize;var item=this.items.get(index);menuItems.push(this.autoGenMenuItem(item));}this.tabsMenu.add({text:this.tabScrollerMenu.getMenuPrefixText()+" "+(curPage-pageSize+1)+" - "+curPage,menu:menuItems,iconCls:"p-icons-bullet_blue"});}if(remainder>0){var start=numSubMenus*pageSize;menuItems=[];for(var i=start;i<totalItems;i++){var item=this.items.get(i);menuItems.push(this.autoGenMenuItem(item));}this.tabsMenu.add({text:this.tabScrollerMenu.menuPrefixText+" "+(start+1)+" - "+(start+menuItems.length),menu:menuItems});}}else{this.items.each(function(item){if(item.id!=curActive.id&&!item.hidden){this.tabsMenu.add(this.autoGenMenuItem(item));}},this);}},autoGenMenuItem:function(item){var maxText=this.tabScrollerMenu.getMaxText();var text=Ext.util.Format.ellipsis(item.title,maxText);return{text:text,handler:this.showTabFromMenu,scope:this,disabled:item.disabled,tabToShow:item,iconCls:item.iconCls};},showTabFromMenu:function(menuItem){this.setActiveTab(menuItem.tabToShow);}}});Ext.reg("tabscrollermenu",Ext.ux.TabScrollerMenu);(function(){Ext.ux.ThemePicker=Ext.extend(Ext.ColorPalette,{constructor:function(_cfg){Ext.apply(this,_cfg);Ext.ux.ThemePicker.superclass.constructor.call(this,{autoShow:true,colors:["000000","545554","ABADAF","D8D8D8","424370","52567E","5E7189","BDD3EF","D1C5FF","9ACD68","9CD4C1","FC6161","E2B4D5","C49E92","FFB5B5","FF8C37","C72929"],listeners:{"select":function(palette,selColor){switch(selColor){case"000000":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-slickness.css");break;case"545554":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-black.css");break;case"ABADAF":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-darkgray.css");break;case"D8D8D8":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-gray.css");break;case"424370":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-midnight.css");break;case"52567E":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-indigo.css");break;case"5E7189":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-slate.css");break;case"BDD3EF":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext-all.css");break;case"D1C5FF":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-purple.css");break;case"9ACD68":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-olive.css");break;case"9CD4C1":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-green.css");break;case"FC6161":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-red5.css");break;case"FFB5B5":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-peppermint.css");break;case"E2B4D5":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-pink.css");break;case"C49E92":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-chocolate.css");break;case"FF8C37":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"ext/xtheme-orange.css");break;case"C72929":Ext.util.CSS.swapStyleSheet("theme",JH.getCssRoot()+"/ext/xtheme-silverCherry.css");break;}}}});}});})();Ext.reg("uxThemePicker",Ext.ux.ThemePicker);Ext.ns("Ext.ux");Ext.ux.TreePanel=Ext.extend(Ext.tree.TreePanel,{constructor:function(config){Ext.apply(this,config,{rootVisible:false,collapseMode:"mini",split:true,autoScroll:true,tools:[{id:"refresh",handler:function(){this.root.reload();},scope:this}],border:false,loader:new Ext.tree.TreeLoader({baseParams:{service:Ext.isDefined(config.service)?config.service:JH.getCurrentService(),method:config.method},url:JH.getAjaxURL()}),root:new Ext.tree.AsyncTreeNode({id:"root",text:"树形菜单",expanded:true})});Ext.ux.TreePanel.superclass.constructor.call(this,config);}});Ext.reg("uxtree",Ext.ux.TreePanel);Ext.ns("Ext.ux");(function(){Ext.ux.Window=Ext.extend(Ext.Window,{constructor:function(config){Ext.ux.Window.superclass.constructor.call(this,Ext.applyIf(config,{closeAction:"hide",plain:true,buttonAlign:"center",modal:true,labelAlign:"right",constrainHeader:true,shadow:false,collapsible:true,titleCollapse:true,resizable:false}));}});})();Ext.reg("uxWindow",Ext.ux.Window);
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(config){Ext.ux.Spinner.superclass.constructor.call(this,config);Ext.apply(this,config);this.mimicing=false;},init:function(field){this.field=field;field.afterMethod("onRender",this.doRender,this);field.afterMethod("onEnable",this.doEnable,this);field.afterMethod("onDisable",this.doDisable,this);field.afterMethod("afterRender",this.doAfterRender,this);field.afterMethod("onResize",this.doResize,this);field.afterMethod("onFocus",this.doFocus,this);field.beforeMethod("onDestroy",this.doDestroy,this);},doRender:function(ct,position){var el=this.el=this.field.getEl();var f=this.field;if(!f.wrap){f.wrap=this.wrap=el.wrap({cls:"x-form-field-wrap"});}else{this.wrap=f.wrap.addClass("x-form-field-wrap");}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!f.width){this.wrap.setWidth(el.getWidth()+this.trigger.getWidth());}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner();},doAfterRender:function(){var y;if(Ext.isIE&&this.el.getY()!=(y=this.trigger.getY())){this.el.position();this.el.setY(y);}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass);}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass);}},doResize:function(w,h){if(typeof w=="number"){this.el.setWidth(w-this.trigger.getWidth());}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth());},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this);}},checkTab:function(e){if(e.getKey()==e.TAB){this.triggerBlur();}},mimicBlur:function(e){if(!this.wrap.contains(e.target)&&this.field.validateBlur(e)){this.triggerBlur();}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field);},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click");},initSpinner:function(){this.field.addEvents({"spin":true,"spinup":true,"spindown":true});this.keyNav=new Ext.KeyNav(this.el,{"up":function(e){e.preventDefault();this.onSpinUp();},"down":function(e){e.preventDefault();this.onSpinDown();},"pageUp":function(e){e.preventDefault();this.onSpinUpAlternate();},"pageDown":function(e){e.preventDefault();this.onSpinDownAlternate();},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this);},onMouseOver:function(){if(this.disabled){return;}var middle=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<middle)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass);},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass);},onMouseMove:function(){if(this.disabled){return;}var middle=this.getMiddle();if(((Ext.EventObject.getPageY()>middle)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<middle)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return;}var middle=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<middle)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass);},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass);},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return;}var middle=this.getMiddle();var ud=(Ext.EventObject.getPageY()<middle)?"Up":"Down";this["onSpin"+ud]();},getMiddle:function(){var t=this.trigger.getTop();var h=this.trigger.getHeight();var middle=t+(h/2);return middle;},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false;}return true;},handleMouseWheel:function(e){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return;}var delta=e.getWheelDelta();if(delta>0){this.onSpinUp();e.stopEvent();}else{if(delta<0){this.onSpinDown();e.stopEvent();}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop();},endDrag:function(){this.proxy.hide();},onDrag:function(){if(this.disabled){return;}var y=Ext.fly(this.dd.getDragEl()).getTop();var ud="";if(this._previousY>y){ud="Up";}if(this._previousY<y){ud="Down";}if(ud!=""){this["onSpin"+ud]();}this._previousY=y;},onSpinUp:function(){if(this.isSpinnable()==false){return;}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return;}else{this.spin(false,false);}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this);},onSpinDown:function(){if(this.isSpinnable()==false){return;}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return;}else{this.spin(true,false);}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this);},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return;}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this);},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return;}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this);},spin:function(down,alternate){var v=parseFloat(this.field.getValue());var incr=(alternate==true)?this.alternateIncrementValue:this.incrementValue;(down==true)?v-=incr:v+=incr;v=(isNaN(v))?this.defaultValue:v;v=this.fixBoundries(v);this.field.setRawValue(v);},fixBoundries:function(value){var v=value;if(this.field.minValue!=undefined&&v<this.field.minValue){v=this.field.minValue;}if(this.field.maxValue!=undefined&&v>this.field.maxValue){v=this.field.maxValue;}return this.fixPrecision(v);},fixPrecision:function(value){var nan=isNaN(value);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||nan||!value){return nan?"":value;}return parseFloat(parseFloat(value).toFixed(this.field.decimalPrecision));},doDestroy:function(){if(this.trigger){this.trigger.remove();}if(this.wrap){this.wrap.remove();delete this.field.wrap;}if(this.splitter){this.splitter.remove();}if(this.dd){this.dd.unreg();this.dd=null;}if(this.proxy){this.proxy.remove();}if(this.repeater){this.repeater.purgeListeners();}if(this.mimicing){Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);}}});Ext.form.Spinner=Ext.ux.Spinner;
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.form");Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(config){var spinnerConfig=Ext.copyTo({},config,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var spl=this.spinner=new Ext.ux.Spinner(spinnerConfig);var plugins=config.plugins?(Ext.isArray(config.plugins)?config.plugins.push(spl):[config.plugins,spl]):spl;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(config,{plugins:plugins}));},getResizeEl:function(){return this.wrap;},getPositionEl:function(){return this.wrap;},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}},validateBlur:function(){return true;}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.ns("Ext.ux.form");Ext.ux.form.TextField=Ext.extend(Ext.form.TextField,{unitText:"",EnterQueryHandler:"",onRender:function(ct,position){Ext.ux.form.TextField.superclass.onRender.call(this,ct,position);this.createUnit(ct,position);this.registerEnterQueryEvent();},createUnit:function(ct,position){if(this.unitText!=""){this.unitEl=ct.createChild({tag:"font",html:this.unitText});if(typeof(this.width)!="undefined"&&this.width>0){this.width=this.width-(this.unitText.replace(/[^\x00-\xff]/g,"xx").length*6+10);}this.alignErrorIcon=function(){this.errorIcon.alignTo(this.unitEl,"tl-tr",[2,0]);};}},registerEnterQueryEvent:function(){this.on("specialkey",function(field,e){if(e.getKey()==e.ENTER){Ext.invoke(this.scope,this.EnterQueryHandler,null);}},this);}});Ext.reg("uxtextfield",Ext.ux.form.TextField);Ext.ux.form.NumberField=Ext.extend(Ext.form.NumberField,{unitText:"",EnterQueryHandler:"",onRender:function(ct,position){Ext.ux.form.NumberField.superclass.onRender.call(this,ct,position);this.createUnit(ct,position);this.registerEnterQueryEvent();},createUnit:function(ct,position){if(this.unitText!=""){this.unitEl=ct.createChild({tag:"font",html:this.unitText});if(typeof(this.width)!="undefined"&&this.width>0){this.width=this.width-(this.unitText.replace(/[^\x00-\xff]/g,"xx").length*6+10);}this.alignErrorIcon=function(){this.errorIcon.alignTo(this.unitEl,"tl-tr",[2,0]);};}},registerEnterQueryEvent:function(){this.on("specialkey",function(field,e){if(e.getKey()==e.ENTER){Ext.invoke(this.scope,this.EnterQueryHandler,null);}},this);}});Ext.reg("uxtextnumber",Ext.ux.form.NumberField);Ext.ns("Ext.ux.form");Ext.ux.form.TimePickerField=function(config){Ext.ux.form.TimePickerField.superclass.constructor.call(this,config);};Ext.extend(Ext.ux.form.TimePickerField,Ext.form.Field,{defaultAutoCreate:{tag:"div"},cls:"x-form-timepickerfield",hoursSpinner:null,minutesSpinner:null,secondsSpinner:null,spinnerCfg:{width:40},spinnerFixBoundries:function(value){if(value<this.field.minValue){value=this.field.maxValue;}if(value>this.field.maxValue){value=this.field.minValue;}return this.fixPrecision(value);},onRender:function(ct,position){Ext.ux.form.TimePickerField.superclass.onRender.call(this,ct,position);this.rendered=false;this.date=new Date();var values={};if(this.value){values=this._valueSplit(this.value);this.date.setHours(values.h);this.date.setMinutes(values.m);this.date.setSeconds(values.s);delete this.value;}else{values={h:this.date.getHours(),m:this.date.getMinutes(),s:this.date.getSeconds()};}var spinnerWrap=Ext.DomHelper.append(this.el,{tag:"div"});var cfg=Ext.apply({},this.spinnerCfg,{renderTo:spinnerWrap,readOnly:this.readOnly,disabled:this.disabled,listeners:{spin:{fn:this.onSpinnerChange,scope:this},valid:{fn:this.onSpinnerChange,scope:this},afterrender:{fn:function(spinner){spinner.wrap.applyStyles("float: left");},single:true}}});this.hoursSpinner=new Ext.ux.form.SpinnerField(Ext.apply({},cfg,{minValue:0,maxValue:23,cls:"first",value:values.h}));this.minutesSpinner=new Ext.ux.form.SpinnerField(Ext.apply({},cfg,{minValue:0,maxValue:59,value:values.m}));this.secondsSpinner=new Ext.ux.form.SpinnerField(Ext.apply({},cfg,{minValue:0,maxValue:59,value:values.s}));Ext.DomHelper.append(spinnerWrap,{tag:"div",cls:"x-form-clear-left"});this.rendered=true;},_valueSplit:function(v){var split=v.split(":");return{h:split.length>0?split[0]:0,m:split.length>1?split[1]:0,s:split.length>2?split[2]:0};},onSpinnerChange:function(){if(!this.rendered){return;}this.fireEvent("change",this,this.getRawValue());},disable:function(){Ext.ux.form.TimePickerField.superclass.disable.call(this);this.hoursSpinner.disable();this.minutesSpinner.disable();this.secondsSpinner.disable();},enable:function(){Ext.ux.form.TimePickerField.superclass.enable.call(this);this.hoursSpinner.enable();this.minutesSpinner.enable();this.secondsSpinner.enable();},setReadOnly:function(r){Ext.ux.form.TimePickerField.superclass.setReadOnly.call(this,r);this.hoursSpinner.setReadOnly(r);this.minutesSpinner.setReadOnly(r);this.secondsSpinner.setReadOnly(r);},clearInvalid:function(){Ext.ux.form.TimePickerField.superclass.clearInvalid.call(this);this.hoursSpinner.clearInvalid();this.minutesSpinner.clearInvalid();this.secondsSpinner.clearInvalid();},getRawValue:function(){if(!this.hoursSpinner){this.date=new Date();return{h:this.date.getHours(),m:this.date.getMinutes(),s:this.date.getSeconds()};}else{return{h:this.hoursSpinner.getValue(),m:this.minutesSpinner.getValue(),s:this.secondsSpinner.getValue()};}},setRawValue:function(v){this.hoursSpinner.setValue(v.h);this.minutesSpinner.setValue(v.m);this.secondsSpinner.setValue(v.s);},isValid:function(preventMark){return this.hoursSpinner.isValid(preventMark)&&this.minutesSpinner.isValid(preventMark)&&this.secondsSpinner.isValid(preventMark);},validate:function(){return this.hoursSpinner.validate()&&this.minutesSpinner.validate()&&this.secondsSpinner.validate();},getValue:function(){var v=this.getRawValue();return String.leftPad(v.h,2,"0")+":"+String.leftPad(v.m,2,"0")+":"+String.leftPad(v.s,2,"0");},setValue:function(value){if(!this.rendered){this.value=value;return;}value=this._valueSplit(value);this.setRawValue(value);this.validate();}});Ext.form.TimePickerField=Ext.ux.form.TimePickerField;Ext.reg("timepickerfield",Ext.form.TimePickerField);Ext.ns("Ext.ux.form");Ext.DateTimePicker=Ext.extend(Ext.DatePicker,{timeFormat:"g:i:s A",timeLabel:"时间",timeWidth:100,initComponent:function(){Ext.DateTimePicker.superclass.initComponent.call(this);this.id=Ext.id();},onRender:function(container,position){Ext.DateTimePicker.superclass.onRender.apply(this,arguments);var table=Ext.get(Ext.DomQuery.selectNode("table tbody",container.dom));var tfEl=Ext.DomHelper.insertBefore(table.last(),{tag:"tr",children:[{tag:"td",cls:"x-date-bottom",html:this.timeLabel,style:"width:30;"},{tag:"td",cls:"x-date-bottom ux-timefield",colspan:"2"}]},true);this.tf.render(table.child("td.ux-timefield"));var p=this.getEl().parent("div.x-layer");if(p){p.setStyle("height",p.getHeight()+31);}},setValue:function(value){var old=this.value;if(!this.tf){this.tf=new Ext.ux.form.TimePickerField();this.tf.ownerCt=this;}this.value=this.getDateTime(value);},getDateTime:function(value){if(this.tf){var dt=new Date();var timeval=this.tf.getValue();value=Date.parseDate(value.format(this.dateFormat)+" "+this.tf.getValue(),this.format);}return value;},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.value=this.getDateTime(new Date());this.fireEvent("select",this,this.value);}}});Ext.reg("datetimepickerfield",Ext.DateTimePicker);if(parseInt(Ext.version.substr(0,1),10)>2){Ext.menu.DateTimeItem=Ext.DateTimePicker;Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20});}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.DatePicker(Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item"},this.initialConfig))});Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this);}}});}else{Ext.menu.DateTimeItem=function(config){Ext.menu.DateTimeItem.superclass.constructor.call(this,new Ext.DateTimePicker(config),config);this.picker=this.component;this.addEvents("select");this.picker.on("render",function(picker){picker.getEl().swallowEvent("click");picker.container.addClass("x-menu-date-item");});this.picker.on("select",this.onSelect,this);};Ext.extend(Ext.menu.DateTimeItem,Ext.menu.DateMenu,{onSelect:function(picker,date){this.fireEvent("select",this,date,picker);Ext.menu.DateTimeItem.superclass.handleClick.call(this);}});}Ext.menu.DateTimeMenu=function(config){Ext.menu.DateTimeMenu.superclass.constructor.call(this,config);this.plain=true;var di=new Ext.menu.DateTimeItem(config);this.add(di);this.picker=di;this.relayEvents(di,["select"]);this.on("beforeshow",function(){if(this.picker){this.picker.hideMonthPicker(true);}},this);};Ext.extend(Ext.menu.DateTimeMenu,Ext.menu.Menu,{cls:"x-date-menu",beforeDestroy:function(){this.picker.destroy();},hide:function(deep){if(this.picker.tf.innerList){if((Ext.EventObject.within(this.picker.tf.innerList))||(Ext.get(Ext.EventObject.getTarget())==this.picker.tf.innerList)){return false;}}if(this.el&&this.isVisible()){this.fireEvent("beforehide",this);if(this.activeItem){this.activeItem.deactivate();this.activeItem=null;}this.el.hide();this.hidden=true;this.fireEvent("hide",this);}if(deep===true&&this.parentMenu){this.parentMenu.hide(true);}}});Ext.ux.form.DateTimeField=Ext.extend(Ext.form.DateField,{dateFormat:"Y-m-d",timeFormat:"H:i:s",defaultAutoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off"},initComponent:function(){Ext.ux.form.DateTimeField.superclass.initComponent.call(this);this.format=this.dateFormat+" "+this.timeFormat;this.afterMethod("afterRender",function(){this.getEl().applyStyles("top:0");});},getValue:function(){return this.parseDate(Ext.form.DateField.superclass.getValue.call(this))||"";},onTriggerClick:function(){if(this.disabled){return;}if(this.menu==null){this.menu=new Ext.menu.DateTimeMenu();}Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.ddMatch,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,timeFormat:this.timeFormat,dateFormat:this.dateFormat,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});if(this.menuEvents){this.menuEvents("on");}else{this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));}this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");}});Ext.reg("datetimefield",Ext.ux.form.DateTimeField);
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.GroupSummary=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this,config);Ext.ux.grid.GroupSummary.superclass.constructor.call(this);},init:function(grid){this.grid=grid;var v=this.view=grid.getView();v.doGroupEnd=this.doGroupEnd.createDelegate(this);v.afterMethod("onColumnWidthUpdated",this.doWidth,this);v.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);v.afterMethod("onColumnHiddenUpdated",this.doHidden,this);v.afterMethod("onUpdate",this.doUpdate,this);v.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true;}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true;}this.cellTpl.compile();},toggleSummaries:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass("x-grid-hide-summary");}el[visible?"removeClass":"addClass"]("x-grid-hide-summary");}},renderSummary:function(o,cs){cs=cs||this.view.getColumnData();var cfg=this.grid.getColumnModel().config,buf=[],c,p={},cf,last=cs.length-1;for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];p.id=c.id;p.style=c.style;p.css=i==0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o);}else{p.value="";}if(p.value==undefined||p.value===""){p.value="&#160;";}buf[buf.length]=this.cellTpl.apply(p);}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:buf.join("")});},calculate:function(rs,cs){var data={},r,c,cfg=this.grid.getColumnModel().config,cf;for(var j=0,jlen=rs.length;j<jlen;j++){r=rs[j];for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];if(cf.summaryType){data[c.name]=Ext.ux.grid.GroupSummary.Calculations[cf.summaryType](data[c.name]||0,r,c.name,data);}}}return data;},doGroupEnd:function(buf,g,cs,ds,colCount){var data=this.calculate(g.rs,cs);buf.push("</div>",this.renderSummary({data:data},cs),"</div>");},doWidth:function(col,w,tw){if(!this.isGrouped()){return;}var gs=this.view.getGroups(),len=gs.length,i=0,s;for(;i<len;++i){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w;}},doAllWidths:function(ws,tw){if(!this.isGrouped()){return;}var gs=this.view.getGroups(),len=gs.length,i=0,j,s,cells,wlen=ws.length;for(;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;cells=s.firstChild.rows[0].childNodes;for(j=0;j<wlen;j++){cells[j].style.width=ws[j];}}},doHidden:function(col,hidden,tw){if(!this.isGrouped()){return;}var gs=this.view.getGroups(),len=gs.length,i=0,s,display=hidden?"none":"";for(;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display;}},isGrouped:function(){return !Ext.isEmpty(this.grid.getStore().groupField);},refreshSummary:function(groupValue){return this.refreshSummaryById(this.view.getGroupId(groupValue));},getSummaryNode:function(gid){var g=Ext.fly(gid,"_gsummary");if(g){return g.down(".x-grid3-summary-row",true);}return null;},refreshSummaryById:function(gid){var g=Ext.getDom(gid);if(!g){return false;}var rs=[];this.grid.getStore().each(function(r){if(r._groupId==gid){rs[rs.length]=r;}});var cs=this.view.getColumnData(),data=this.calculate(rs,cs),markup=this.renderSummary({data:data},cs),existing=this.getSummaryNode(gid);if(existing){g.removeChild(existing);}Ext.DomHelper.append(g,markup);return true;},doUpdate:function(ds,record){this.refreshSummaryById(record._groupId);},doRemove:function(ds,record,index,isUpdate){if(!isUpdate){this.refreshSummaryById(record._groupId);}},showSummaryMsg:function(groupValue,msg){var gid=this.view.getGroupId(groupValue),node=this.getSummaryNode(gid);if(node){node.innerHTML='<div class="x-grid3-summary-msg">'+msg+"</div>";}}});Ext.grid.GroupSummary=Ext.ux.grid.GroupSummary;Ext.ux.grid.GroupSummary.Calculations={"sum":function(v,record,field){return v+(record.data[field]||0);},"count":function(v,record,field,data){return data[field+"count"]?++data[field+"count"]:(data[field+"count"]=1);},"max":function(v,record,field,data){var v=record.data[field];var max=data[field+"max"]===undefined?(data[field+"max"]=v):data[field+"max"];return v>max?(data[field+"max"]=v):max;},"min":function(v,record,field,data){var v=record.data[field];var min=data[field+"min"]===undefined?(data[field+"min"]=v):data[field+"min"];return v<min?(data[field+"min"]=v):min;},"average":function(v,record,field,data){var c=data[field+"count"]?++data[field+"count"]:(data[field+"count"]=1);var t=(data[field+"total"]=((data[field+"total"]||0)+(record.data[field]||0)));return t===0?0:t/c;}};Ext.grid.GroupSummary.Calculations=Ext.ux.grid.GroupSummary.Calculations;Ext.ux.grid.HybridSummary=Ext.extend(Ext.ux.grid.GroupSummary,{calculate:function(rs,cs){var gcol=this.view.getGroupField(),gvalue=rs[0].data[gcol],gdata=this.getSummaryData(gvalue);return gdata||Ext.ux.grid.HybridSummary.superclass.calculate.call(this,rs,cs);},updateSummaryData:function(groupValue,data,skipRefresh){var json=this.grid.getStore().reader.jsonData;if(!json.summaryData){json.summaryData={};}json.summaryData[groupValue]=data;if(!skipRefresh){this.refreshSummary(groupValue);}},getSummaryData:function(groupValue){var reader=this.grid.getStore().reader,json=reader.jsonData,fields=reader.recordType.prototype.fields,v;if(json&&json.summaryData){v=json.summaryData[groupValue];if(v){return reader.extractValues(v,fields.items,fields.length);}}return null;}});Ext.grid.HybridSummary=Ext.ux.grid.HybridSummary;